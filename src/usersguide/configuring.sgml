<chapter id="configuring" xreflabel="Configuring">
<title>Configuring Nagios</title>


<para>
Configuring nagios on your cluster involves specifying information for three
kinds of nagios objects.  Nagios <emphasis>contacts</emphasis> specify email
addresses to notify when the state of your cluster changes.  Nagios
<emphasis>hosts</emphasis> describe the compute nodes or similar resources
that are part of your cluster.  Nagios <emphasis>services</emphasis> are the
host attributes or network services that nagios monitors.
</para><para>
Configuration for each of these nagios objects can be managed using the
<command>rocks</command> command-line tool, as described below.
</para>

<section id="configuring-contacts" xreflabel="Configuring Contacts">
<title>Configuring Nagios Contacts</title>
<para>
You can use the <command>rocks add nagios contact</command> command to specify
additional emails to notify in the event of cluster status changes, the
<command>rocks remove nagios contact</command> command to delete emails, and the
<command>rocks list nagios contact</command> command to show the emails you've
entered.  The <command>rocks add nagios host</command> command has this format:
<screen>
# rocks add nagios contact email=<emphasis>login@host</emphasis> [groups=<emphasis>group</emphasis>[,<emphasis>group ...</emphasis>]]
</screen>
The <command>groups</command> parameter allows you to specify one or more
<emphasis>contact groups</emphasis> that should include the new contact.  These
groups are used later when you specify which contacts should receive
notification about host and service state changes.  If you specify no
<command>groups</command> parameter, the <command>rocks</command> command
generates a group from the email.
</para><para>
Here is an example of using several <command>rocks</command> commands to add,
remove, and list nagios contacts:
<screen>
# rocks add nagios contact email=alf@ufo.edu
# rocks list nagios contact
email="alf@ufo.edu" groups="alf@ufo.edu group"
# rocks add nagios contact email=r2d2@ufo.edu groups=administrators
# rocks list nagios contact
email="alf@ufo.edu" groups="alf@ufo.edu group"
email="r2d2@ufo.edu" groups="administrators"
# rocks remove nagios contact alf@ufo.edu
# rocks list nagios contact
email="r2d2@ufo.edu" groups="administrators"
</screen>
</para>
</section>

<section id="configuring-hosts" xreflabel="Configuring Hosts">
<title>Configuring Nagios Hosts</title>
<para>
You can use the <command>rocks add nagios host</command> command to tell nagios
about resources in your cluster, the <command>rocks remove nagios host</command>
command to delete hosts, and the <command>rocks list nagios host</command>
command to show the hosts you've entered.  The <command>rocks add nagios
host</command> command has this format:
<screen>
# rocks add nagios host name=<emphasis>string</emphasis> ip=<emphasis>address</emphasis> contacts=<emphasis>group</emphasis>[,<emphasis>group ...</emphasis>] \
  [groups=<emphasis>group</emphasis>[,<emphasis>group ...</emphasis>]]
</screen>
The <command>contacts</command> parameter specifies one or more contact groups
(defined in the <command>rocks add nagios contact</command> command) that
should receive email when the state of this host changes.  The
<command>groups</command> parameter allows you to specify one or more
<emphasis>host groups</emphasis> that should include the new host.  These
groups are used later when you specify which hosts provide specific services.
If you specify no <command>groups</command> parameter, the
<command>rocks</command> command generates a group from the host name.
</para><para>
Here is an example of using several <command>rocks</command> commands to add,
remove, and list nagios hosts:
<screen>
# rocks add nagios host name=c1 ip=10.1.255.250 contacts=administrators
# rocks add nagios host name=c2 ip=10.1.255.249 contacts=administrators groups=bignodes
# rocks list nagios host
name="c2" ip="10.1.255.249" contacts="administrators" groups="bignodes"
name="c1" ip="10.1.255.250" contacts="administrators" groups="c1 group"
# rocks remove nagios host c1
# rocks list nagios host
name="c2" ip="10.1.255.249" contacts="administrators" groups="bignodes"
</screen>
You may never need to use the <command>rocks add nagios host</command>
directly.  The <command>rocks sync nagios</command> command automatically adds
all the hosts in your cluster to nagios, placing each in a group named after its
appliance type.  Here is an example of its use:
<screen>
# rocks list nagios host
# rocks sync nagios contacts=administrators
# rocks list nagios host
name="compute-0-0-appliance" ip="10.1.255.254" contacts="administrators" groups="Compute-group"
name="compute-0-1-appliance" ip="10.1.255.253" contacts="administrators" groups="Compute-group"
name="compute-0-2-appliance" ip="10.1.255.252" contacts="administrators" groups="Compute-group"
name="compute-0-3-appliance" ip="10.1.255.251" contacts="administrators" groups="Compute-group"
&lt;etc.&gt;
name="blue-appliance" ip="10.1.1.1" contacts="administrators" groups="Frontend-group"
</screen>
</para>
</section>

<section id="configuring-services" xreflabel="Configuring Services">
<title>Configuring Nagios Services</title>
<para>
</para>
</section>


</chapter>
