<?xml version="1.0" standalone="no"?>

<kickstart>

<description>
Nagios system monitor
http://www.nagios.org
</description>

<copyright>
Copyright (c) 2000 - 2011 The Regents of the University of California.
All rights reserved. Rocks(r) v5.1 www.rocksclusters.org
</copyright>

<changelog>
</changelog>

<package>nagios</package>
<package>nagios-plugins</package>
<package>nagios-roll-test</package>
<package>rocks-command-nagios</package>

<post>

groupadd -g 413 nagios
useradd -M -u413 -c "Nagios Monitoring" -d /opt/nagios -G apache,nagios nagios

cp /opt/nagios/etc/daemon-init /etc/rc.d/init.d/nagios
chmod 0755 /etc/rc.d/init.d/nagios

mkdir -p /opt/nagios/var/rw
chmod g+s /opt/nagios/var/rw

cp /opt/nagios/etc/httpd.conf /etc/httpd/conf.d/nagios.conf
chmod 0644 /etc/httpd/conf.d/nagios.conf

<file name="/opt/nagios/etc/htpasswd.users" perms="0644">
nagiosadmin:&Kickstart_PrivateRootPassword;
</file>

/bin/chown -R nagios:apache /opt/nagios
/sbin/chkconfig nagios on

/opt/rocks/bin/rocks add nagios contact \
  email='&Info_ClusterContact;' \
  groups='administrators'
/opt/rocks/bin/rocks add nagios host \
  name='&Kickstart_PrivateHostname;' \
  ip='&Kickstart_PrivateAddress;' \
  contacts='administrators' \
  groups='allhosts'

</post>

</kickstart>
