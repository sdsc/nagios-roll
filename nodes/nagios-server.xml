<?xml version="1.0" standalone="no"?>


<kickstart>


<description>
</description>


<changelog>
$Log$
Revision 1.1  2009/02/05 18:36:05  bruno
added

</changelog>


<package>nagios</package>
<package>nagios-plugins</package>
<package>nagios-insert-ethers</package>
<package>rocks-command-nagios</package>
<package>roll-nagios-usersguide</package>



<post>

<file name="/etc/httpd/conf.d/nagios.conf" perms="0444">
<![CDATA[
ScriptAlias /nagios/cgi-bin /opt/nagios/sbin

<Directory "/opt/nagios/sbin">
    Options ExecCGI
    AllowOverride None
    Order allow,deny
    Allow from all
    AuthName "Nagios Access"
    AuthType Basic
    AuthUserFile /opt/nagios/etc/htpasswd.users
    Require valid-user
</Directory>

Alias /nagios /opt/nagios/share

<Directory "/opt/nagios/share">
    Options None
    AllowOverride None
    Order allow,deny
    Allow from all
    AuthName "Nagios Access"
    AuthType Basic
    AuthUserFile /opt/nagios/etc/htpasswd.users
    Require valid-user
</Directory>
]]>
</file>


/usr/sbin/useradd -M -u413 -c "Nagios Monitoring" -d /opt/nagios nagios


<file name="/opt/nagios/etc/htpasswd.users" perms="0440">
nagios:<var name="Kickstart_PrivateRootPassword"/>
</file>

mkdir -p /opt/nagios/etc/hosts

<file name="/opt/nagios/etc/hosts/localnodes.cfg"
      expr="/opt/rocks/bin/rocks list nagios"/>

<file name="/opt/nagios/etc/cgi.cfg" mode="append">

##
## ROCKS
##
authorized_for_system_information=nagios
authorized_for_configuration_information=nagios
authorized_for_system_commands=nagios
authorized_for_all_services=nagios
authorized_for_all_hosts=nagios
authorized_for_all_service_commands=nagios
authorized_for_all_host_commands=nagios
</file>

<file name="/opt/nagios/etc/nagios.cfg" mode="append">

##
## ROCKS
##
cfg_file=/opt/nagios/etc/hosts/localnodes.cfg
</file>


mkdir -p /opt/nagios/.ssh/
touch /opt/nagios/.ssh/id_rsa.pub

chown -R nagios.apache /opt/nagios

/sbin/chkconfig nagios on

</post>


</kickstart> 

