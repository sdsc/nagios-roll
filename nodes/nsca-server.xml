<?xml version="1.0" standalone="no"?>

<kickstart>

  <description>
  NSCA Nagios plug-in for Nagios server
  http://www.nagios.org
  </description>

  <copyright>
  Copyright (c) 2000 - 2008 The Regents of the University of California.
  All rights reserved. Rocks(r) v5.1 www.rocksclusters.org
  </copyright>

  <changelog>
  $Log$
  Revision 1.8  2009/10/18 16:31:31  jhayes
  Add URLs.

  </changelog>

  <package>nsca</package>

  <post>

  <!-- adapted from nsca-2.7.2/sample_config/nsca.cfg -->
  <file name="/opt/nagios/etc/nsca.cfg" perms="0644">
##
## ROCKS
##
pid_file=/opt/nagios/var/nsca.pid
server_port=5667
server_address=<var name="Kickstart_PrivateAddress"/>
nsca_user=nagios
nsca_group=apache
debug=1
command_file=/opt/nagios/var/rw/nagios.cmd
alternate_dump_file=/opt/nagios/var/rw/nsca.dump
aggregate_writes=0
append_to_file=0
max_packet_age=30
# We're restricting to local network; password would be overkill
#password=
decryption_method=1
</file> <!-- NOTE: nsca pukes if we indent this closing tag! -->

  <file name="/etc/services" mode="append">
nsca            5667/tcp                        # NSCA Nagios add-on
  </file>

  <!-- adapted from nsca-2.7.2/sample_config/nsca.xinetd.d -->
  <file name="/etc/xinetd.d/nsca" perms="0644">
# default: on
# description: NSCA (Nagios Service Check Acceptor)
service nsca
{
       	flags           = REUSE
        socket_type     = stream        
       	wait            = no
        user            = nagios
        group		= apache
       	server          = /opt/nagios/bin/nsca
        server_args     = -c /opt/nagios/etc/nsca.cfg --inetd
       	log_on_failure  += USERID
        disable         = no
        only_from       = <var name="Kickstart_PrivateAddress"/>/<var name="Kickstart_PrivateNetmaskCIDR"/>
}
  </file>

  /bin/chown -R nagios.apache /opt/nagios

  /opt/rocks/bin/rocks add var NSCA ServerName <var name="Kickstart_PrivateHostname"/>

  </post>

</kickstart>
