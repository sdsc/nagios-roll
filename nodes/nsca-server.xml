<?xml version="1.0" standalone="no"?>

<kickstart>

  <description>
  NSCA Nagios plug-in for Nagios server
  </description>

  <copyright>
  Copyright (c) 2000 - 2008 The Regents of the University of California.
  All rights reserved. Rocks(r) v5.1 www.rocksclusters.org
  </copyright>

  <changelog>
  $Log$
  Revision 1.3  2009/04/23 17:48:11  jhayes
  Build send_nsca on target for portability.

  Revision 1.2  2009/04/21 20:50:52  jhayes
  Add NSCA configuration files.

  Revision 1.1  2009/04/21 17:59:01  jhayes
  Initial additions for NSCA plug-in.

  </changelog>

  <package>nsca</package>

  <post>

  <!-- adapted from nsca-2.7.2/sample_config/nsca.cfg -->
  <file name="/opt/nagios/etc/nsca.cfg" perms="0644">
##
## ROCKS
##
pid_file=/opt/nagios/var/nsca.pid
server_port=5667
server_address=<var name="Kickstart_PrivateAddress"/>
nsca_user=nagios
nsca_group=apache
nsca_chroot=/opt/nagios/var/rw
debug=0
command_file=/opt/nagios/var/rw/nagios.cmd
alternate_dump_file=/opt/nagios/var/rw/nsca.dump
aggregate_writes=0
append_to_file=0
max_packet_age=30
# We're restricting to local network; password would be overkill
#password=
decryption_method=1
  </file>

  <file name="/etc/services" mode="append">
nsca            5667/tcp                        # NSCA Nagios add-on
  </file>

  <!-- adapted from nsca-2.7.2/sample_config/nsca.xinetd.d -->
  <file name="/etc/xinetd.d/nsca" perms="0644">
# default: on
# description: NSCA (Nagios Service Check Acceptor)
service nsca
{
       	flags           = REUSE
        socket_type     = stream        
       	wait            = no
        user            = nagios
        group		= apache
       	server          = /opt/nagios/bin/nsca
        server_args     = -c /opt/nagios/etc/nsca.cfg --inetd
       	log_on_failure  += USERID
        disable         = no
        only_from       = <var name="Kickstart_PrivateAddress"/>
}
  </file>

  </post>

</kickstart>
