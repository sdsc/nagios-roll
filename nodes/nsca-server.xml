<?xml version="1.0" standalone="no"?>

<kickstart>

<description>
NSCA Nagios plug-in for Nagios server
http://www.nagios.org
</description>

<copyright>
Copyright (c) 2000 - 2011 The Regents of the University of California.
All rights reserved. Rocks(r) v5.1 www.rocksclusters.org
</copyright>

<changelog>
</changelog>

<package>nsca</package>

<post>

<file name="/etc/services" mode="append">
nsca            5667/tcp                        # NSCA Nagios add-on
</file>

<!-- adapted from nsca-2.7.2/sample_config/nsca.xinetd.d -->
<file name="/etc/xinetd.d/nsca" perms="0644">
# default: on
# description: NSCA (Nagios Service Check Acceptor)
service nsca
{
       	flags           = REUSE
        socket_type     = stream        
       	wait            = no
        user            = nagios
        group		= apache
       	server          = /opt/nagios/bin/nsca
        server_args     = -c /opt/nagios/etc/nsca.cfg --inetd
       	log_on_failure  += USERID
        disable         = no
        only_from       = &Kickstart_PrivateAddress;/&Kickstart_PrivateNetmaskCIDR;
        cps             = 400 10
}
</file>

/bin/chown -R nagios:apache /opt/nagios

/opt/rocks/bin/rocks set attr NSCA_ServerName &Kickstart_PrivateHostname;
/opt/rocks/bin/rocks set attr NSCA_ServerAddr &Kickstart_PrivateAddress;

</post>

</kickstart>
