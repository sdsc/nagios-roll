<?xml version="1.0" standalone="no"?>

<kickstart>

  <description>
  NSCA Nagios plug-in for Nagios client
  </description>

  <copyright>
  Copyright (c) 2000 - 2008 The Regents of the University of California.
  All rights reserved. Rocks(r) v5.1 www.rocksclusters.org
  </copyright>

  <changelog>
  $Log$
  Revision 1.5  2009/04/23 20:39:03  jhayes
  Work around nsca weirdness.

  Revision 1.4  2009/04/23 20:10:31  jhayes
  Portability tweaks.  Remove libmcrypt, since we're not using it.

  Revision 1.3  2009/04/23 17:48:10  jhayes
  Build send_nsca on target for portability.

  Revision 1.2  2009/04/21 20:50:52  jhayes
  Add NSCA configuration files.

  Revision 1.1  2009/04/21 17:59:01  jhayes
  Initial additions for NSCA plug-in.

  </changelog>

  <package>send-nsca</package>

  <post>

  if test -f /usr/sbin/useradd.real; then
    USERADD=/usr/sbin/useradd.real
  else
    USERADD=/usr/sbin/useradd
  fi
  $USERADD -M -u413 -c "Nagios Monitoring" -d /opt/nagios nagios

  /bin/mkdir -p /opt/nagios/bin
  /bin/mkdir -p /opt/nagios/etc

  cd /opt/nagios/tar
  /bin/tar zxvf send-nsca.tar.gz
  cd nsca*
  ./configure
  make
  /bin/cp src/send_nsca /opt/nagios/bin/

  <!-- adapted from nsca-2.7.2/sample_config/send_nsca.cfg -->
  <file name="/opt/nagios/etc/send_nsca.cfg" perms="0644">
##
## ROCKS
##
# We're restricting to local network; password would be overkill
#password=
encryption_method=1
</file> <!-- NOTE: send_nsca pukes if we indent this closing tag! -->

  /bin/chown -R nagios.nagios /opt/nagios

  </post>

</kickstart>
